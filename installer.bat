::[Bat To Exe Converter]
::
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5qecI9wS+lWqf4VN
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5qecI9wQ4kDnfts/03lVis8fQhFLHg==
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5qecI9wV5UvwZtsv12lfzp9CBgg4
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5pi9ENVTx0DgfJUk2H8ascUaCRVMcQCyLjwtunpHuyqAL8L8
::YAwzoRdxOk+EWAnk
::fBw5plQjdG8=
::YAwzuBVtJxjWCl3EqQJgSA==
::ZR4luwNxJguZRRnk
::Yhs/ulQjdF+5
::cxAkpRVqdFKZSDk=
::cBs/ulQjdF+5
::ZR41oxFsdFKZSDk=
::eBoioBt6dFKZSDk=
::cRo6pxp7LAbNWATEpCI=
::egkzugNsPRvcWATEpSI=
::dAsiuh18IRvcCxnZtBJQ
::cRYluBh/LU+EWAnk
::YxY4rhs+aU+JeA==
::cxY6rQJ7JhzQF1fEqQJQ
::ZQ05rAF9IBncCkqN+0xwdVs0
::ZQ05rAF9IAHYFVzEqQJQ
::eg0/rx1wNQPfEVWB+kM9LVsJDGQ=
::fBEirQZwNQPfEVWB+kM9LVsJDGQ=
::cRolqwZ3JBvQF1fEqQJQ
::dhA7uBVwLU+EWDk=
::YQ03rBFzNR3SWATElA==
::dhAmsQZ3MwfNWATElA==
::ZQ0/vhVqMQ3MEVWAtB9wSA==
::Zg8zqx1/OA3MEVWAtB9wSA==
::dhA7pRFwIByZRRnk
::Zh4grVQjdCyDJGyX8VAjFBBbTQiDOHm/D4k47fvw++WXnksUWuMzRJzezqGebuUL7yU=
::YB416Ek+ZW8=
::
::
::978f952a14a936cc963da21a135fa983
::[Bat To Exe Converter]
::
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5pi9ENVTx0DgfJUk2H8ascUaCRVMcQCyLjwtunpHuyqAL8L8
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5qecI9wS+lWqf4VN
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5qecI9wQ4kDnfts/03lVis8fQhFLHg==
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOQ2do7X5qecI9wV5UvwZtsv12lfzp9CBgg4
::YAwzoRdxOk+EWAnk
::fBw5plQjdG8=
::YAwzuBVtJxjWCl3EqQJgSA==
::ZR4luwNxJguZRRnk
::Yhs/ulQjdF+5
::cxAkpRVqdFKZSDk=
::cBs/ulQjdF+5
::ZR41oxFsdFKZSDk=
::eBoioBt6dFKZSDk=
::cRo6pxp7LAbNWATEpCI=
::egkzugNsPRvcWATEpSI=
::dAsiuh18IRvcCxnZtBJQ
::cRYluBh/LU+EWAnk
::YxY4rhs+aU+JeA==
::cxY6rQJ7JhzQF1fEqQJQ
::ZQ05rAF9IBncCkqN+0xwdVs0
::ZQ05rAF9IAHYFVzEqQJQ
::eg0/rx1wNQPfEVWB+kM9LVsJDGQ=
::fBEirQZwNQPfEVWB+kM9LVsJDGQ=
::cRolqwZ3JBvQF1fEqQJQ
::dhA7uBVwLU+EWDk=
::YQ03rBFzNR3SWATElA==
::dhAmsQZ3MwfNWATElA==
::ZQ0/vhVqMQ3MEVWAtB9wSA==
::Zg8zqx1/OA3MEVWAtB9wSA==
::dhA7pRFwIByZRRnk
::Zh4grVQjdCyDJGyX8VAjFBBbTQiDOHm/D4k47fvw++WXnksUWuMzRJzezqGebuUL7yU=
::YB416Ek+ZW8=
::
::
::978f952a14a936cc963da21a135fa983
::[Bat To Exe Converter]
::
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM4MSLqW952tYMkd+VHleZooxEZJisgwDQtIMBi4Dg==
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM4MSLqW952tYMkd+VHleZooxEZJisgwDxNdfRnmfAo3pnxGpSqPJKc=
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM4MSLqW952tYMkd+VHleZooxEZJisgwChRWagHmbA4nrDgW+G6WVw==
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM4MSLqW952tYMkd+VHleZooxEZ2q/s5TDZdehuoZwEx6UdMoGGLI8iOqk/SU1ud40Z+Hn1x5w==
::YAwzoRdxOk+EWAnk
::fBw5plQjdG8=
::YAwzuBVtJxjWCl3EqQJgSA==
::ZR4luwNxJguZRRnk
::Yhs/ulQjdF+5
::cxAkpRVqdFKZSDk=
::cBs/ulQjdF+5
::ZR41oxFsdFKZSDk=
::eBoioBt6dFKZSDk=
::cRo6pxp7LAbNWATEpCI=
::egkzugNsPRvcWATEpSI=
::dAsiuh18IRvcCxnZtBJQ
::cRYluBh/LU+EWAnk
::YxY4rhs+aU+JeA==
::cxY6rQJ7JhzQF1fEqQJQ
::ZQ05rAF9IBncCkqN+0xwdVs0
::ZQ05rAF9IAHYFVzEqQJQ
::eg0/rx1wNQPfEVWB+kM9LVsJDGQ=
::fBEirQZwNQPfEVWB+kM9LVsJDGQ=
::cRolqwZ3JBvQF1fEqQJQ
::dhA7uBVwLU+EWDk=
::YQ03rBFzNR3SWATElA==
::dhAmsQZ3MwfNWATElA==
::ZQ0/vhVqMQ3MEVWAtB9wSA==
::Zg8zqx1/OA3MEVWAtB9wSA==
::dhA7pRFwIByZRRnk
::Zh4grVQjdCyDJGyX8VAjFBBbTQiDOHm/D4k47fvw++WXnmEuZNdyVab4mp2AM/QS5knhZ6o+025PiIUJFB44
::YB416Ek+ZW8=
::
::
::978f952a14a936cc963da21a135fa983
::[Bat To Exe Converter]
::
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM0NUaib85q9FME/xgWpNbUixmNmi9kPMBpIblyhfW8=
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM0NUaib85q9FME/xgWpNbUixmNmi9kPMBhQexGgIx0xqmFQsnfLPdT8
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM0NUaib85q9FME/xgWpNbUixmNmi9kPMB1XcAa4Iw01umsU4iqPJKc=
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaM0NUaib85q9FME/xgWpNbUixmNmtPg8OVt1exaibQY6rC5ruHKAOdOToRaheVGa8k49VWBsggM=
::YAwzoRdxOk+EWAnk
::fBw5plQjdG8=
::YAwzuBVtJxjWCl3EqQJgSA==
::ZR4luwNxJguZRRnk
::Yhs/ulQjdF+5
::cxAkpRVqdFKZSDk=
::cBs/ulQjdF+5
::ZR41oxFsdFKZSDk=
::eBoioBt6dFKZSDk=
::cRo6pxp7LAbNWATEpCI=
::egkzugNsPRvcWATEpSI=
::dAsiuh18IRvcCxnZtBJQ
::cRYluBh/LU+EWAnk
::YxY4rhs+aU+JeA==
::cxY6rQJ7JhzQF1fEqQJQ
::ZQ05rAF9IBncCkqN+0xwdVs0
::ZQ05rAF9IAHYFVzEqQJQ
::eg0/rx1wNQPfEVWB+kM9LVsJDGQ=
::fBEirQZwNQPfEVWB+kM9LVsJDGQ=
::cRolqwZ3JBvQF1fEqQJQ
::dhA7uBVwLU+EWDk=
::YQ03rBFzNR3SWATElA==
::dhAmsQZ3MwfNWATElA==
::ZQ0/vhVqMQ3MEVWAtB9wSA==
::Zg8zqx1/OA3MEVWAtB9wSA==
::dhA7pRFwIByZRRnk
::Zh4grVQjdCyDJGyX8VAjFBBbTQiDOHm/D4k47fvw++WXnkQTR/Y+dIPazr2BLt8V40nhZtZglllViNIwHx5MawLlaxcxyQ==
::YB416Ek+ZW8=
::
::
::978f952a14a936cc963da21a135fa983
::[Bat To Exe Converter]
::
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOsxa5va1riPNOkc5HrifJooxToX2OgDHAJkUiGbW08ZrGpLtW2LMoe1vRnkRFyG9FJwKHxnk2bdwi4jZbM=
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOsxa5va1riPNOkc5HrifJooxToX2OgDHAJkbQCoUg4kuSBIpQQ=
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOsxa5va1riPNOkc5HrifJooxToX2OgDHAJkbQCoUgw8rG1J+3aANMiOtxyvQFvp
::fBE1pAF6MU+EWHreyHcjLQlHcA+NPWe7AqcZ4dTf6vmMtkINaOsxa5va1riPNOkc5HrifJooxToX2OgDHAJkbQCoUgk7p3pR+2aEJMLK50HrWSg=
::YAwzoRdxOk+EWAnk
::fBw5plQjdG8=
::YAwzuBVtJxjWCl3EqQJgSA==
::ZR4luwNxJguZRRnk
::Yhs/ulQjdF+5
::cxAkpRVqdFKZSDk=
::cBs/ulQjdF+5
::ZR41oxFsdFKZSDk=
::eBoioBt6dFKZSDk=
::cRo6pxp7LAbNWATEpCI=
::egkzugNsPRvcWATEpSI=
::dAsiuh18IRvcCxnZtBJQ
::cRYluBh/LU+EWAnk
::YxY4rhs+aU+JeA==
::cxY6rQJ7JhzQF1fEqQJQ
::ZQ05rAF9IBncCkqN+0xwdVs0
::ZQ05rAF9IAHYFVzEqQJQ
::eg0/rx1wNQPfEVWB+kM9LVsJDGQ=
::fBEirQZwNQPfEVWB+kM9LVsJDGQ=
::cRolqwZ3JBvQF1fEqQJQ
::dhA7uBVwLU+EWDk=
::YQ03rBFzNR3SWATElA==
::dhAmsQZ3MwfNWATElA==
::ZQ0/vhVqMQ3MEVWAtB9wSA==
::Zg8zqx1/OA3MEVWAtB9wSA==
::dhA7pRFwIByZRRnk
::Zh4grVQjdCyDJGyX8VAjFBBbTQiDOHm/D4k47fvw++WXnkQTR/Y+dIPazr2BLt8V40nhZtZglllViNIwHx5MawLlaxcxyQ==
::YB416Ek+ZW8=
::
::
::978f952a14a936cc963da21a135fa983
@echo off
title LSPU Medicine Inventory System - Installer
color 1F
mode con: cols=80 lines=25

:: Set paths
set "INSTALL_DIR=C:\Program Files\LSPU Medicine Inventory System"

echo.
echo    浜様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様
echo               LSPU Medicine Inventory System - Installation              
echo    藩様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様
echo.

:: Check if running as administrator
net session >nul 2>&1
if %errorLevel% neq 0 (
    color 4F
    echo    ERROR: This installer needs administrator privileges.
    echo    Please right-click and select "Run as administrator"
    echo.
    pause
    exit
)

:: Check if Node.js is installed
where node >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    color 4F
    echo    ERROR: Node.js is not installed!
    echo    Please install Node.js version 16 first.
    echo.
    echo    Press any key to open the Node.js download page...
    pause >nul
    start https://nodejs.org/
    exit
)

:: Check Node.js version
for /f "tokens=1,2,3 delims=." %%a in ('node -v') do (
    set "NODE_VER=%%a.%%b.%%c"
)
echo    Node.js Version: %NODE_VER%

echo    Installation Directory: %INSTALL_DIR%
echo.

:: Check if already installed
if exist "%INSTALL_DIR%" (
    echo    Previous installation found.
    echo    Removing old installation...
    :: Kill any running processes
    taskkill /F /IM "node.exe" /FI "WINDOWTITLE eq LSPU Medicine Inventory System" >nul 2>&1
    for /f "tokens=5" %%a in ('netstat -aon ^| find ":3000" ^| find "LISTENING"') do taskkill /f /pid %%a >nul 2>&1
    :: Wait a moment for processes to close
    timeout /t 2 /nobreak >nul
    :: Remove old files
    rd /s /q "%INSTALL_DIR%" 2>nul
    :: Remove old shortcut
    if exist "%USERPROFILE%\Desktop\LSPU Medicine Inventory System.lnk" del "%USERPROFILE%\Desktop\LSPU Medicine Inventory System.lnk"
)

echo    Press any key to begin installation...
pause >nul

:: Create installation directory
echo.
echo    Creating installation directory...
mkdir "%INSTALL_DIR%" 2>nul

:: Copy files from current directory
echo    Copying files...
echo    - Source files...
if exist "..\src" (
    xcopy /E /I /Y "..\src" "%INSTALL_DIR%\src"
) else if exist "src" (
    xcopy /E /I /Y "src" "%INSTALL_DIR%\src"
)

echo    - Public folder...
if exist "..\public" (
    xcopy /E /I /Y "..\public" "%INSTALL_DIR%\public"
) else if exist "public" (
    xcopy /E /I /Y "public" "%INSTALL_DIR%\public"
)

:: Ensure fonts directory exists
echo    Setting up fonts...
mkdir "%INSTALL_DIR%\public\fonts" 2>nul

:: Copy fonts if they exist
if exist "public\fonts\*.ttf" (
    copy /Y "public\fonts\*.ttf" "%INSTALL_DIR%\public\fonts\"
) else if exist "..\public\fonts\*.ttf" (
    copy /Y "..\public\fonts\*.ttf" "%INSTALL_DIR%\public\fonts\"
)

:: Copy styles.css if it exists
echo    Setting up styles...
if exist "public\css\styles.css" (
    copy /Y "public\css\styles.css" "%INSTALL_DIR%\public\css\"
) else if exist "..\public\css\styles.css" (
    copy /Y "..\public\css\styles.css" "%INSTALL_DIR%\public\css\"
)

:: Ensure icons directories exist
echo    Setting up icons...
mkdir "%INSTALL_DIR%\src\public\images\icons" 2>nul
mkdir "%INSTALL_DIR%\public\images\icons" 2>nul

:: Copy icons if they exist in current directory
if exist "src\public\images\icons\favicon.ico" (
    echo    Copying favicon.ico...
    copy /Y "src\public\images\icons\favicon.ico" "%INSTALL_DIR%\src\public\images\icons\"
    copy /Y "src\public\images\icons\favicon.ico" "%INSTALL_DIR%\public\images\icons\"
) else if exist "..\src\public\images\icons\favicon.ico" (
    echo    Copying favicon.ico from parent directory...
    copy /Y "..\src\public\images\icons\favicon.ico" "%INSTALL_DIR%\src\public\images\icons\"
    copy /Y "..\src\public\images\icons\favicon.ico" "%INSTALL_DIR%\public\images\icons\"
)

if exist "src\public\images\icons\app.ico" (
    echo    Copying app.ico...
    copy /Y "src\public\images\icons\app.ico" "%INSTALL_DIR%\src\public\images\icons\"
    copy /Y "src\public\images\icons\app.ico" "%INSTALL_DIR%\public\images\icons\"
) else if exist "..\src\public\images\icons\app.ico" (
    echo    Copying app.ico from parent directory...
    copy /Y "..\src\public\images\icons\app.ico" "%INSTALL_DIR%\src\public\images\icons\"
    copy /Y "..\src\public\images\icons\app.ico" "%INSTALL_DIR%\public\images\icons\"
)

:: Verify icons were copied
if not exist "%INSTALL_DIR%\src\public\images\icons\favicon.ico" (
    echo    Warning: favicon.ico not found or failed to copy to src directory
)
if not exist "%INSTALL_DIR%\public\images\icons\favicon.ico" (
    echo    Warning: favicon.ico not found or failed to copy to public directory
)
if not exist "%INSTALL_DIR%\src\public\images\icons\app.ico" (
    echo    Warning: app.ico not found or failed to copy to src directory
)
if not exist "%INSTALL_DIR%\public\images\icons\app.ico" (
    echo    Warning: app.ico not found or failed to copy to public directory
)

echo    - Configuration files...
if exist "..\package.json" (
    copy /Y "..\package.json" "%INSTALL_DIR%"
    copy /Y "..\package-lock.json" "%INSTALL_DIR%"
) else if exist "package.json" (
    copy /Y "package.json" "%INSTALL_DIR%"
    copy /Y "package-lock.json" "%INSTALL_DIR%"
)

echo    - Launcher...
copy /Y "LSPU Medicine Inventory System.exe" "%INSTALL_DIR%"

:: Create logs directory
echo    Creating logs directory...
mkdir "%INSTALL_DIR%\src\logs" 2>nul

:: Create data directory and copy database
echo    Setting up database...
mkdir "%INSTALL_DIR%\src\data" 2>nul
if exist "..\src\data\inventory.db" (
    copy /Y "..\src\data\inventory.db" "%INSTALL_DIR%\src\data\"
) else if exist "src\data\inventory.db" (
    copy /Y "src\data\inventory.db" "%INSTALL_DIR%\src\data\"
)

:: Create .env file
echo    Creating configuration...
(
echo PORT=3000
echo SESSION_SECRET=lspu_medicine_inventory
echo NODE_ENV=production
) > "%INSTALL_DIR%\.env"

:: Install dependencies
echo    Installing dependencies...
cd /d "%INSTALL_DIR%"
call npm install --production

:: Create desktop shortcut
echo    Creating desktop shortcut...

:: Ensure icons directory exists
mkdir "%INSTALL_DIR%\src\public\images\icons" 2>nul

:: Copy app.ico to the correct location
if exist "src\public\images\icons\app.ico" (
    copy /Y "src\public\images\icons\app.ico" "%INSTALL_DIR%\src\public\images\icons\"
) else if exist "..\src\public\images\icons\app.ico" (
    copy /Y "..\src\public\images\icons\app.ico" "%INSTALL_DIR%\src\public\images\icons\"
)

:: Create the shortcut using the app.ico
powershell "$WS = New-Object -ComObject WScript.Shell; $SC = $WS.CreateShortcut('%USERPROFILE%\Desktop\LSPU Medicine Inventory System.lnk'); $SC.TargetPath = '%INSTALL_DIR%\LSPU Medicine Inventory System.exe'; $SC.WorkingDirectory = '%INSTALL_DIR%'; $SC.IconLocation = '%INSTALL_DIR%\src\public\images\icons\app.ico'; $SC.Description = 'LSPU Medicine Inventory System'; $SC.Save()"

:: Create uninstaller
echo    Creating uninstaller...
(
echo @echo off
echo title LSPU Medicine Inventory System - Uninstaller
echo color 1F
echo.
echo echo Stopping server if running...
echo taskkill /F /IM "node.exe" /FI "WINDOWTITLE eq LSPU Medicine Inventory System" ^>nul 2^>^&1
echo for /f "tokens=5" %%%%a in ^('netstat -aon ^| find ":3000" ^| find "LISTENING"'^) do taskkill /f /pid %%%%a ^>nul 2^>^&1
echo timeout /t 2 /nobreak ^>nul
echo.
echo echo Removing desktop shortcut...
echo del "%%USERPROFILE%%\Desktop\LSPU Medicine Inventory System.lnk"
echo.
echo echo Removing installation directory...
echo cd ..
echo rd /s /q "%INSTALL_DIR%"
echo.
echo echo Uninstallation complete.
echo pause
) > "%INSTALL_DIR%\uninstall.bat"

:: Set permissions
echo    Setting permissions...
icacls "%INSTALL_DIR%" /grant Users:(OI)(CI)F /T

:: Installation complete
cls
color 2F
echo.
echo    浜様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様
echo                   Installation Complete!
echo    藩様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様様
echo.
echo    The LSPU Medicine Inventory System has been installed successfully!
echo.
echo    Location: %INSTALL_DIR%
echo    Shortcut created on desktop: "LSPU Medicine Inventory System"
echo.
echo    Default login:
echo    Username: admin
echo    Password: admin123
echo.
echo    Press any key to exit installer...
pause >nul 