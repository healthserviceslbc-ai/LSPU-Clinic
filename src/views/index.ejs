<%- contentFor('style') %>
<style>
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-badge.ongoing {
        background-color: rgba(59, 130, 246, 0.1);
        color: rgb(29, 78, 216);
    }

    .status-badge.finished {
        background-color: rgba(16, 185, 129, 0.1);
        color: rgb(4, 120, 87);
    }

    .hover-card {
        transition: all 0.2s ease;
    }

    .hover-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
</style>

<%- contentFor('body') %>
<div class="bg-white rounded-lg shadow-lg p-6 flex flex-col space-y-4" style="height: calc(100vh - 12rem);">
    <!-- Header Section -->
    <div class="flex justify-between items-center pb-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">Dashboard Overview</h1>
            <p class="text-sm text-gray-600 mt-1">Welcome to LSPU Medicine Inventory System</p>
        </div>
        <div class="flex gap-3">
            <a href="/reports/monthly?highlight=report" 
                class="bg-purple-500 text-white py-2.5 px-5 rounded-lg hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 flex items-center gap-2 shadow-md">
                <i class="fas fa-chart-bar"></i>
                Generate Report
            </a>
            <a href="/transactions?openModal=true" 
                class="bg-blue-500 text-white py-2.5 px-5 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 flex items-center gap-2 shadow-md">
                <i class="fas fa-plus"></i>
                New Transaction
            </a>
        </div>
    </div>

    <!-- Content Area with Fixed Height -->
    <div class="flex flex-col space-y-4 flex-1">
        <!-- Quick Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Recent Transactions Card -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 hover-card">
                <div class="flex items-center gap-4 mb-2">
                    <div class="p-3 bg-blue-500 text-white rounded-lg">
                        <i class="fas fa-exchange-alt text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Recent Transactions</h3>
                        <p class="text-sm text-gray-600">Today's activity</p>
                    </div>
                </div>
                <div class="mt-4">
                    <% if (recentTransactions && recentTransactions.length > 0) { %>
                        <div class="space-y-3">
                            <% recentTransactions.forEach(function(transaction) { %>
                                <div class="bg-white p-3 rounded-lg shadow-sm">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900"><%= transaction.medication || (transaction.remarks && transaction.remarks.includes('Treatment/Advice: ') ? transaction.remarks.split('\n\nAdditional Remarks: ')[0].replace('Treatment/Advice: ', '') : 'No medication') %></p>
                                            <p class="text-xs text-gray-500">
                                                <%= transaction.patient_name %>
                                            </p>
                                            <p class="text-xs text-gray-500">
                                                <% 
                                                function convertTo12Hour(time24) {
                                                    const [hours24, minutes] = time24.split(':');
                                                    const hours = parseInt(hours24);
                                                    const suffix = hours >= 12 ? 'PM' : 'AM';
                                                    const hours12 = hours % 12 || 12;
                                                    return `${hours12}:${minutes} ${suffix}`;
                                                }
                                                %>
                                                Qty: <%= transaction.quantity %> â€¢ <%= convertTo12Hour(transaction.time_started) %>
                                            </p>
                                        </div>
                                        <div class="flex items-center h-full">
                                            <span class="status-badge <%= transaction.time_finished ? 'finished' : 'ongoing' %>">
                                                <%= transaction.time_finished ? 'Finished' : 'Ongoing' %>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <div class="text-center py-4">
                            <i class="fas fa-inbox text-gray-400 text-3xl mb-2"></i>
                            <p class="text-gray-600">No transactions today</p>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Low Stock Alerts Card -->
            <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-6 hover-card">
                <div class="flex items-center gap-4 mb-2">
                    <div class="p-3 bg-red-500 text-white rounded-lg">
                        <i class="fas fa-exclamation-triangle text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Low Stock Alerts</h3>
                        <p class="text-sm text-gray-600">Items needing attention</p>
                    </div>
                </div>
                <div class="mt-4 max-h-[300px] overflow-y-auto">
                    <% if (lowStockItems && lowStockItems.length > 0) { %>
                        <div class="space-y-3">
                            <% lowStockItems.forEach(function(item) { %>
                                <div class="bg-white p-3 rounded-lg shadow-sm">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900"><%= item.name %></p>
                                            <p class="text-xs text-gray-500"><%= item.unit %></p>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <% if (item.current_stock === 0) { %>
                                                <span class="px-2 py-1 text-xs font-semibold text-white bg-red-500 rounded-full">
                                                    Out of Stock
                                                </span>
                                            <% } else { %>
                                                <span class="px-2 py-1 text-xs font-semibold text-red-600 bg-red-100 rounded-full">
                                                    <%= item.current_stock %> left
                                                </span>
                                            <% } %>
                                            <a href="/reports/monthly?action=replenish&medicineId=<%= item.id %>" 
                                               class="p-1.5 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-lg transition-colors"
                                               title="Add Stock">
                                                <i class="fas fa-plus"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <div class="text-center py-4">
                            <i class="fas fa-check-circle text-gray-400 text-3xl mb-2"></i>
                            <p class="text-gray-600">No items are low in stock</p>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Statistics Carousel Card -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 hover-card">
                <div class="flex items-center gap-4 mb-2">
                    <div class="p-3 bg-blue-500 text-white rounded-lg">
                        <i class="fas fa-chart-pie text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Key Statistics</h3>
                        <p class="text-sm text-gray-600">Overall system metrics</p>
                    </div>
                </div>
                <div class="mt-4 relative">
                    <div class="statistics-carousel">
                        <!-- Slides container -->
                        <div class="overflow-hidden relative h-[250px]">
                            <div class="slides-container transition-transform duration-300 h-full">
                                <!-- Transactions Summary -->
                                <div class="slide absolute w-full h-full">
                                    <h4 class="text-lg font-semibold text-gray-700 mb-4">Transactions Summary</h4>
                                    <div class="relative h-[200px]">
                                        <canvas id="transactionsChart" style="width: 100%; height: 100%;"></canvas>
                                    </div>
                                </div>
                                <!-- Patients Served -->
                                <div class="slide absolute w-full h-full translate-x-full">
                                    <h4 class="text-lg font-semibold text-gray-700 mb-4">Total Patients Served</h4>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="bg-white rounded-lg p-4 text-center">
                                            <p class="text-sm text-gray-600">Today</p>
                                            <p class="text-2xl font-bold text-blue-600" id="daily-patients">-</p>
                                        </div>
                                        <div class="bg-white rounded-lg p-4 text-center">
                                            <p class="text-sm text-gray-600">This Week</p>
                                            <p class="text-2xl font-bold text-blue-600" id="weekly-patients">-</p>
                                        </div>
                                        <div class="bg-white rounded-lg p-4 text-center">
                                            <p class="text-sm text-gray-600">This Month</p>
                                            <p class="text-2xl font-bold text-blue-600" id="monthly-patients">-</p>
                                        </div>
                                        <div class="bg-white rounded-lg p-4 text-center">
                                            <p class="text-sm text-gray-600">This Year</p>
                                            <p class="text-2xl font-bold text-blue-600" id="yearly-patients">-</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Common Complaints -->
                                <div class="slide absolute w-full h-full translate-x-[200%]">
                                    <h4 class="text-lg font-semibold text-gray-700 mb-4">Most Common Complaints</h4>
                                    <div class="space-y-3 overflow-y-auto max-h-[180px] pr-2" id="top-complaints">
                                        <div class="bg-white rounded-lg p-4">
                                            <div class="animate-pulse bg-gray-200 h-6 rounded w-3/4"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Complaints Chart -->
                                <div class="slide absolute w-full h-full translate-x-[300%]">
                                    <div class="mb-4">
                                        <h4 class="text-lg font-semibold text-gray-700">Complaints Distribution</h4>
                                    </div>
                                    <div class="relative h-[200px]">
                                        <canvas id="complaintsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Navigation Buttons -->
                        <button class="absolute left-0 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full shadow-lg text-blue-600 transition-all prev-slide">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="absolute right-0 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full shadow-lg text-blue-600 transition-all next-slide">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <!-- Dots -->
                        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 flex space-x-2">
                            <button class="w-2 h-2 rounded-full bg-blue-200 dot active" data-index="0"></button>
                            <button class="w-2 h-2 rounded-full bg-blue-200 dot" data-index="1"></button>
                            <button class="w-2 h-2 rounded-full bg-blue-200 dot" data-index="2"></button>
                            <button class="w-2 h-2 rounded-full bg-blue-200 dot" data-index="3"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
    // Register the plugin
    Chart.register(ChartDataLabels);
    
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize both chart and carousel
        initTransactionsChart();
        initStatisticsCarousel();
    });

    function initTransactionsChart() {
        console.log('Chart initialization started');
        const canvas = document.getElementById('transactionsChart');
        
        if (!canvas) {
            console.error('Chart canvas element not found');
            return;
        }
        console.log('Chart canvas element found');
        
        const ctx = canvas.getContext('2d');
        if (!ctx) {
            console.error('Failed to get 2D context');
            return;
        }
        console.log('Canvas 2D context obtained');
        
        // Add loading indicator
        const loadingHtml = `
            <div class="text-center py-4 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                <i class="fas fa-spinner fa-spin text-blue-500 text-3xl mb-2"></i>
                <p class="text-gray-600">Loading transaction data...</p>
            </div>
        `;
        canvas.parentElement.insertAdjacentHTML('beforeend', loadingHtml);
        
        // Fetch real transaction data
        console.log('Fetching transaction data...');
        fetch('/api/transactions/last-7-days')
            .then(response => {
                console.log('API Response:', response);
                return response.json();
            })
            .then(data => {
                console.log('Received transaction data:', data);
                
                // Remove loading indicator
                const loadingElement = canvas.parentElement.querySelector('.text-center');
                if (loadingElement) {
                    loadingElement.remove();
                }

                const chartData = {
                    labels: data.map(item => item.date),
                    datasets: [{
                        label: 'Transactions',
                        data: data.map(item => item.count),
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1,
                        borderRadius: 5,
                        barThickness: 15
                    }]
                };

                console.log('Chart data prepared:', chartData);

                const config = {
                    type: 'bar',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                top: 10,
                                right: 10,
                                bottom: 10,
                                left: 10
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: (tooltipItems) => {
                                        return `${tooltipItems[0].label}`;
                                    },
                                    label: (context) => {
                                        const count = context.raw;
                                        return `${count} transaction${count !== 1 ? 's' : ''}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    precision: 0,
                                    font: {
                                        size: 11
                                    }
                                },
                                grid: {
                                    display: false
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        }
                    }
                };

                console.log('Creating chart with config:', config);
                new Chart(ctx, config);
                console.log('Chart created successfully');
            })
            .catch(error => {
                console.error('Error in chart creation:', error);
                // Display error message in the chart area
                const chartArea = canvas.parentElement;
                chartArea.innerHTML = `
                    <div class="text-center py-4 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-gray-600">Failed to load transaction data</p>
                    </div>
                `;
            });
    }

    function initStatisticsCarousel() {
        const carousel = document.querySelector('.statistics-carousel');
        const slidesContainer = carousel.querySelector('.slides-container');
        const slides = carousel.querySelectorAll('.slide');
        const prevBtn = carousel.querySelector('.prev-slide');
        const nextBtn = carousel.querySelector('.next-slide');
        const dots = carousel.querySelectorAll('.dot');
        let currentSlide = 0;
        const totalSlides = slides.length;
        let complaintsChart = null;
        let autoSlideInterval;

        // Function to start auto-slide timer
        function startAutoSlide() {
            // Clear any existing interval first
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
            }
            // Start new interval
            autoSlideInterval = setInterval(nextSlide, 10000);
        }

        // Function to reset auto-slide timer
        function resetAutoSlide() {
            startAutoSlide();
        }

        // Helper function to capitalize first letter of each word
        function capitalizeWords(str) {
            return str.toLowerCase().split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        // Helper function to create complaints chart
        function createComplaintsChart(data) {
            const ctx = document.getElementById('complaintsChart').getContext('2d');
            const totalCases = data.reduce((sum, item) => sum + item.count, 0);
            
            if (complaintsChart) {
                complaintsChart.destroy();
            }

            complaintsChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.map(item => capitalizeWords(item.name)),
                    datasets: [{
                        data: data.map(item => item.count),
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.7)',   // Blue
                            'rgba(16, 185, 129, 0.7)',   // Green
                            'rgba(245, 158, 11, 0.7)',   // Yellow
                            'rgba(239, 68, 68, 0.7)',    // Red
                            'rgba(139, 92, 246, 0.7)'    // Purple
                        ],
                        borderColor: 'white',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 11
                                },
                                generateLabels: (chart) => {
                                    const datasets = chart.data.datasets;
                                    const labels = chart.data.labels.map((label, i) => ({
                                        text: `${label} (${datasets[0].data[i]})`,
                                        fillStyle: datasets[0].backgroundColor[i],
                                        strokeStyle: datasets[0].borderColor,
                                        lineWidth: datasets[0].borderWidth,
                                        hidden: false,
                                        index: i
                                    }));
                                    
                                    // Add total cases as the first item
                                    labels.unshift({
                                        text: `Total: ${totalCases} cases`,
                                        fillStyle: 'transparent',
                                        strokeStyle: 'transparent',
                                        lineWidth: 0,
                                        hidden: false,
                                        index: -1
                                    });
                                    
                                    return labels;
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const value = context.raw;
                                    const percentage = ((value / totalCases) * 100).toFixed(1);
                                    return `${value} cases (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: 'white',
                            font: {
                                weight: 'bold',
                                size: 11
                            },
                            formatter: (value) => {
                                const percentage = ((value / totalCases) * 100).toFixed(1);
                                return `${value}\n(${percentage}%)`;
                            }
                        }
                    }
                }
            });
        }

        function updateSlides() {
            slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
            // Update dots
            dots.forEach((dot, index) => {
                dot.classList.toggle('bg-blue-500', index === currentSlide);
                dot.classList.toggle('bg-blue-200', index !== currentSlide);
            });
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateSlides();
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateSlides();
        }

        // Event listeners with timer reset
        nextBtn.addEventListener('click', () => {
            nextSlide();
            resetAutoSlide();
        });
        
        prevBtn.addEventListener('click', () => {
            prevSlide();
            resetAutoSlide();
        });
        
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                currentSlide = index;
                updateSlides();
                resetAutoSlide();
            });
        });

        // Start the initial auto-slide
        startAutoSlide();

        // Helper function to export complaints data to CSV
        function exportComplaintsToCSV() {
            const complaintsData = window.complaintsData || [];
            if (complaintsData.length === 0) {
                alert('No data available to export');
                return;
            }

            // Calculate total cases for percentage
            const totalCases = complaintsData.reduce((sum, item) => sum + item.count, 0);

            // Prepare CSV content
            const csvContent = [
                ['Complaint', 'Number of Cases', 'Percentage'],
                ...complaintsData.map(item => [
                    capitalizeWords(item.name),
                    item.count,
                    ((item.count / totalCases) * 100).toFixed(1) + '%'
                ])
            ].map(row => row.join(',')).join('\n');

            // Create and trigger download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `complaints_data_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Fetch and update statistics
        fetch('/api/statistics')
            .then(response => {
                console.log('Statistics API Response:', response);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Received statistics data:', data);

                // Store complaints data globally for CSV export
                window.complaintsData = data.complaints || [];

                // Update patients counts
                const patientElements = {
                    'daily-patients': data.patients.today,
                    'weekly-patients': data.patients.thisWeek,
                    'monthly-patients': data.patients.thisMonth,
                    'yearly-patients': data.patients.thisYear
                };

                Object.entries(patientElements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value || '0';
                    } else {
                        console.error(`Element not found: ${id}`);
                    }
                });

                // Update top complaints list
                const complaintsContainer = document.getElementById('top-complaints');
                if (complaintsContainer) {
                    if (!data.complaints || data.complaints.length === 0) {
                        complaintsContainer.innerHTML = `
                            <div class="bg-white rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600">No complaints recorded</p>
                            </div>
                        `;
                    } else {
                        const totalCases = data.complaints.reduce((sum, item) => sum + item.count, 0);
                        complaintsContainer.innerHTML = data.complaints.map(complaint => `
                            <div class="bg-white rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <p class="text-sm font-medium text-gray-900">${capitalizeWords(complaint.name)}</p>
                                    <div class="flex items-center gap-2">
                                        <span class="px-2 py-1 text-xs font-semibold text-blue-600 bg-blue-100 rounded-full">
                                            ${complaint.count} cases
                                        </span>
                                        <span class="text-xs text-gray-500">
                                            ${complaint.percentage}%
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                }

                // Create complaints chart
                if (data.complaints && data.complaints.length > 0) {
                    createComplaintsChart(data.complaints);
                }
            })
            .catch(error => {
                console.error('Error fetching statistics:', error);
                // Show error state in all containers
                ['daily-patients', 'weekly-patients', 'monthly-patients', 'yearly-patients'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = '-';
                    }
                });

                ['top-complaints'].forEach(id => {
                    const container = document.getElementById(id);
                    if (container) {
                        container.innerHTML = `
                            <div class="bg-white rounded-lg p-4 text-center">
                                <i class="fas fa-exclamation-circle text-red-500 text-xl mb-2"></i>
                                <p class="text-sm text-gray-600">Failed to load data</p>
                            </div>
                        `;
                    }
                });

                // Show error in complaints chart
                const chartCanvas = document.getElementById('complaintsChart');
                if (chartCanvas) {
                    const container = chartCanvas.parentElement;
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-exclamation-circle text-red-500 text-xl mb-2"></i>
                            <p class="text-sm text-gray-600">Failed to load chart data</p>
                        </div>
                    `;
                }
            });
    }

    async function fetchLast7DaysTransactions() {
        try {
            const response = await fetch('/api/transactions/last-7-days');
            const data = await response.json();
            return data;
        } catch (error) {
            showNotification('Error fetching transaction data', 'error');
            return [];
        }
    }

    async function fetchStatistics() {
        try {
            const response = await fetch('/api/statistics');
            const data = await response.json();
            return data;
        } catch (error) {
            showNotification('Error fetching statistics', 'error');
            return {
                patientStats: { daily: 0, weekly: 0, monthly: 0, yearly: 0 },
                topComplaints: [],
                medicinesByCategory: []
            };
        }
    }

    async function updateDashboard() {
        const transactionData = await fetchLast7DaysTransactions();
        const statistics = await fetchStatistics();
        
        const formattedData = transactionData.map(item => ({
            date: new Date(item.date).toLocaleDateString('en-US', { weekday: 'short' }),
            count: item.count
        }));

        updateTransactionChart(formattedData);
        updateStatistics(statistics.patientStats);
        updateTopComplaints(statistics.topComplaints);
        updateMedicinesByCategory(statistics.medicinesByCategory);
    }
</script> 